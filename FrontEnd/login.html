<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <title>Sophie Bluel - Architecte d'intérieur</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=Work+Sans&display=swap"
    rel="stylesheet">
  <meta name="description" content="">
  <link rel="stylesheet" href="./assets/style.css">
</head>

<body>
  <header>
    <h1>Sophie Bluel <span>Architecte d'intérieur</span></h1>
    <nav>
      <ul>
        <li>projets</li>
        <li>contact</li>
        <li>login</li>
        <li><img src="./assets/icons/instagram.png" alt="Instagram"></li>
      </ul>
    </nav>
  </header>
  <main>

    <section id="contact">
      <h2>Log In</h2>
      <form id="login-form">
        <label for="Email">Email</label>
        <input type="text" name="Email" id="Email" required>
        <label for="motDePasse">Mot de passe</label>
        <input type="password" name="motDePasse" id="motDePasse" required>
        <input type="submit" value="Se connecter">
      </form>
      <div id="error-message" style="color: red;"></div>
    </section>

    <script>
      const loginForm = document.getElementById('login-form');
      const errorMessage = document.getElementById('error-message');

      loginForm.addEventListener('submit', async (event) => {
        event.preventDefault(); // empeche recharge page

        const email = document.getElementById('Email').value;
        const password = document.getElementById('motDePasse').value;

        try {
          const response = await fetch('http://localhost:5678/api/users/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password }),
          });
          console.log("Email :", email);
          console.log("Password :", password);

          const result = await response.json();

          if (response.ok) {
            // stocker token dans localStorage
            localStorage.setItem('token', result.token);
            alert('Connexion réussie !');
            window.location.href = 'index.html'; // Redir après succès
          } else {
            // Afficher un message d'erreur
            throw new Error(result.message || 'Erreur de connexion');
          }
        } catch (error) {
          // Affiche mess erreur connex pour utilisateur
          errorMessage.textContent = error.message;
        }
      });


    </script>

  </main>

  <footer>
    <nav>
      <ul>
        <li>Mentions Légales</li>
      </ul>
    </nav>
  </footer>

  <script>

  </script>
</body>

</html>